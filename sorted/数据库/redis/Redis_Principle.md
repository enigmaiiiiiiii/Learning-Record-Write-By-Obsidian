# 原理

## 缓存淘汰策略

- 当内存不足时，新写入操作会报错: noeviction
- 数据删除策略
  - allkeys-random: 随机删除
  - volatile-random: 随机删除过期数据
  - volatile-ttl: 最近过期的数据
  - allkeys-lru: 最近最少使用的数据
  - volatile-lru: 有时间限制的数据, 距上次使用时间最长的
  - allkeys-lfu: 所有数据, 使用频率最少
  - volatile-lfu: 有时间限制的数据, 使用频率最少

## redis击穿

- **redis击穿**: 请求访问的key不存在, 会从数据库中查找
- 一般需要从数据库中同步到redis

## redis穿透

- 当请求查询的某个key不在Redis中时，就去数据库中查询
- 可以被恶意请求利用: 大量查询不存在的key，导致数据库压力过大
  - 使用布隆过滤器解决

## redis雪崩

- 指的就是Redis中保存的数据短时间内有大量数据同时到期的情况

## redis持久化

- 由于Redis是内存数据库，当Redis服务重启时，数据会丢失
- 策略
  - RDB: 将内存中的数据快照保存到硬盘中, 备份到dump.rdb文件中
    - 优点: 恢复速度快
    - 缺点: 会丢失一些数据
  - AOF: 将每次写入的操作记录到硬盘中
    - 优点: 不会丢失数据
    - 缺点: 占用空间大

## redis存储原理

- hash表

## redis集群

**主从复制**

- 主从复制是一种常用的数据备份方式
- 主机负责读写操作, 备用机负责备份主机数据
- 主机宕机, 备用机会升级为主机

**读写分离**

- 主机执行**读写**操作
- 备用机执行**读**操作
- [ ] TODO

**哨兵模式**

- 检测主备机运行状态完成主备机切换
- [ ] TODO

**哨兵集群**

- 多个哨兵监控主备机, 防止误判
- [ ] TODO

**分片集群**

- Redis有0-16383个槽位, 每个槽位存储一个键值对
- 部署多个Redis实例, 每个实例负责一部分槽位, 这些Redis实例称为**节点**
- 每个节点负责一部分槽位如: 
  - 节点1: 0-5460
  - 节点2: 5461-10922
  - 节点3: 10923-16383
- 一个key通过CRC算法在指定服务器上查找数据
- [ ] TODO
