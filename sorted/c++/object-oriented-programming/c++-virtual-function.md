# C++ - Virtual Function

## What is Virtual Function

- 是**基类**希望**派生类**覆盖的函数, 派生类可以不覆盖虚函数
- virtual关键字，出现在类内部声明语句之前
- 派生类的虚函数的返回类型必须与基类一致或满足继承关系的转换
- 一旦函数被声明成虚函数，则在所有派生类中都是虚函数

## Dynamic Binding

- <font color="red">虚函数的版本是由运行时根据指针或引用所绑定对象的实际类型来选择执行也叫动态绑定</font>

> 普通函数由指针类型决定

- 使用**指针**或**引用**调用虚函数时，该调用将被动态绑定
- 通过**指针**或**引用**对虚函数的调用直到运行时才被解析

## 虚函数定义方式

- 必须有定义; 区别于普通函数的可以只声明不定义
- 如果派生类的虚函数覆盖了某个继承而来的虚函数，则它的形参必须与被覆盖的基类虚函数一致, 参考 [[继承中的作用域]]
- 不能出现在类外部定义

> 调用哪个虚函数，直到运行时根据绑定对象才能确定

## override关键字

- 用在**派生类**中
- **基类同名虚函数参数列表**以及[尾置返回类型](c++-funtion-return-type.md#尾置返回类型)之后
- <font color="red">表示该函数需与原函数参数列表必须完全一致, 否则编译器报错</font>

> <font color="red">不一致是允许的但是不推荐</font>

> 在派生类中，定义与基类虚函数同名，参数列表不同的函数是允许的; 但不推荐，因为不方便调试发现错误，所以新标准添加了override关键字

## final keyword  

- `final`表示该函数不能被覆盖, 不希望被其他类继承
  - 用在形参列表及尾置返回类型后
- 通过`int i = B->A::func()`来强制调用基类A中的成员func,即使func在派生类B中重新实现过

## Pure Virtual Function

- 可以不定义，并在不定义的状态下被派生类覆盖
- 在函数体处填写`=0`,用来表示这是一个纯虚函数, 表示该函数无定义
- 若要提供定义须在类外部定义
- 含有纯虚函数的类被称为抽象基类
  - 定义接口供派生类实现
  - 不能创建抽象基类的对象
- 专门用来继承，避免编写无意义代码

## [虚函数表](c++-virtual-function-vtable.md)
