# JWT Token

## Feature

- JWT: JSON Web Token
- Function: guarantee the data source is **reliable**, verify whether the data has been tampered with
- header, payload can be decoded, but [signature](#signature) is encrypted, can't be decoded
  - so the data source is reliable is guaranteed by signature

## Jwt Structure

- there are 3 parts in a jwt, typical jwt format: `xxxxx.yyyyy.zzzzz`, they are:
  - Header
  - Payload
  - Signature
- header and payload are encoded by [base64](byte-array.md#encode)   
- Signature use [signature algorithm](computer-network-digital-signature.md) to encode, algorithm is specified by `alg` field in header
- Headers, payloads of Any jwt is able to be decoded

use HS256 algorithm as example

- assume the following token string

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

### header

```json
{
    "alg": "HS256",
    "typ": "JWT"
}
```

- `alg`: [signature algorithm](computer-network-encryption.md)
- `typ`: token type

### payload

- called valid payload, include claims

claims is a statement about an entity, which contains three types:

- Registered claims: predefined claims
  - exp: expiration time
  - sub: subject
  - aud: audience, receiver of the token
- [ ] Public claims:
- [ ] Private claims:

```json
{
    "exp": 1666111012,
    "sub": "1234567890",
    "name": "John Doe",
}
```

### Signature

- use to verify whether the token has been tampered with
- **secret part of jwt**

Signature is generated by the encoded header, payload, and a secret

```js
HMACSHA256(
    base64UrlEncode(header) + "." +
    base64UrlEncode(payload),
    your-256-bit-secret
)
```

- signature: use to verify the validity of JWT, complete the data **source** verification
- even if you don't know the secret, you can know the header and payload
- your-256-bit-secret: secret key, only known by the server

## jwt encode



## how to use

1. client send a request to **authorization server**, when authentication success, server return a jwt
2. client save jwt in [local storage](javascript-bom.md#localstorage) or [cookie](http-cookie.md), add jwt to request header every time
3. when user want to access protected resource, user should send a request with Authorization field in [request header](http-request-header.md)

> jwt should not contain too much information, some servers limit the request header size to 8kb, if you really need to include too much information, you can choose [alternative solution]

- combine jwt with httponly cookie can get extra security

## What's For

- Authorization: every request should include jwt, like single sign on
- Information exchange: jwt can be treated as a JSON object, can be used to verify whether the content has been tampered with

