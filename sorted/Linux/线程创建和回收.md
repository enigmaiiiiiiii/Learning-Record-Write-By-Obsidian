# 线程创建和回收

## 1. pthread_create()

```c++
#include <pthread.h>

int pthread_create(pthread_t *thread, 
                   const thread_attr *attr,
                   void *(*start_routine*)(void *),
                   void *arg);
```

- 成功返回0， 失败返回常数
- 参数：
  - thread: 成功返回之前，将创建的线程id存入thread参数
  - attr: 指向thread_attr的指针, 设置线程的attribute
  - start_routine: 
  - arg: 传递给start_routine的唯一参数

## 2. pthread_jion()

```c++
#include <pthread.h>
int pthread_join(pthread_t thread, void **retval)
```

-  等待线程thread完成, 若retval不为NULL, 则目标线程提供给pthread_exit()的值复制到retval指向的对象
- 所以相当于是阻塞等待
- 成功返回0， 失败返回错误数字
- 参数
  - thread: 
  - retval: 如果retval参数不为NULL，将退出状态拷贝到retval指向的地址

## 3. pthread_exit()

```c++
#include <pthread.h>
void pthread_exit(void *retval);
```

- 终止线程并将想要保存的值存入retval指向的地址,
- retval的值可供调用pthread_join()的其他线程使用
- 当线程终止时，线程共享的资源不会被释放
- pthread_exit()和return, 通过return返回会回收所有资源
- pthread_exit将值保存到retval中

[[理解线程终止]]


## 4. pthread_detached()

```c++
#include <pthread.h>
int pthread_detach(pthread_t thread);
```

- 将进程thread设置成可分离的
- 一个可分离的进程终止后，系统会自动回收它的资源，而不需要其他进程去join
- 参数thread: 进程id

## 5. 线程属性 

```c++
#include <pthread.h>
int pthread_attr_init(pthread_attr_t *attr);
int pthread_attr_destroy(pthread_attr_t *attr);
```

### 创建和销毁线程属性pthread_attr_t对象

- pthread_attr_init：创建指针，指向线程pthread_attr_t结构体对象
- pthread_attr_destroy: 销毁attr指向的pthread_attr_t对象

### 查询和设置分离属性

```c++
int pthread_attr_getdetachstate(pthread_attr_t *attr, int *detachstate);
int pthread_attr_setdetachstate(const pthread_attr_t *attr, int detachstate);
```

- 参数
  - detachstate: 设置属性值
    - PTHREAD_CREATE_DETACHED: 用该参数创建的pthread_attr_t 对象, 作为pthread_create的的参数创建的线程, 这个线程是分离状态
    - PTHREAD_CREATE_JOINABLE: 用来创建joinable线程
  - attr: pthread_attr_t结构体
  
### 查询和设置线程栈

### 线程调度属性

[[线程调度]]
